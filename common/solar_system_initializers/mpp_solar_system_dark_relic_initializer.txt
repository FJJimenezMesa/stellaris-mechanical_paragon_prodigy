# ===============================================
# üå† MPP System: Dark Relic
# Sistema aislado con tecnolog√≠a perdida, vestigios de civilizaciones antiguas
# y presencia de drones primitivos y robots antiguos.
# Dominado por un agujero negro central, rodeado de planetas destrozados,
# lunas t√≥xicas, cinturones de asteroides y campos de debris inspirados en
# el Scavenger Bot System.
# Cada planeta tiene su propia historia: ruinas, restos de estaciones,
# artefactos antiguos, dep√≥sitos raros y efectos ambientales que marcan su peligrosidad.
# Este sistema sirve como punto de inter√©s narrativo y exploratorio en la galaxia.
# Incluye zonas de riesgo moderadas y un planeta habitado por robots primitivos.
# ===============================================

# üåå Mini-Mapa ASCII del Sistema
#
# Leyenda:
# ‚¨§  = Agujero negro central
# ‚óé  = Planeta (shrouded, nuked, shattered, gigante gaseoso, barren)
# ‚óâ  = Luna
# *  = Asteroide / escombro / debris field
# ‚ñ≤  = Megaconstrucci√≥n (gateway_ruined, clusters de artefactos antiguos)
# ‚öô  = Planeta de robots primitivos
#
# Vista superior (√≥rbitas aproximadas):
#
#            50 UA Planeta Barren Fr√≠o
#                  ‚óé
#                   *  *  *  (escombros menores)
#
#        45 UA Gigante Gaseoso
#             ‚óé
#            ‚óâ  (Luna T√≥xica)
#            *  *  *  (debris orbitando)
#
#      35 UA Planeta Shattered
#            ‚óé
#            ‚óâ  (Luna Rota)
#            *  *  *  (escombros ambientales)
#
#    28 UA Planeta de Robots Primitivos
#            ‚öô
#            *  *  (debris y restos industriales)
#
#    25 UA Planeta Nuked (Artefactos y dep√≥sitos raros)
#            ‚óé
#            *  *  *  (escombros ambientales)
#            ‚ñ≤  ‚ñ≤  (artefactos antiguos)
#
#  20 UA Planeta Shrouded (Ruinas y escombros)
#            ‚óé
#            *  *  *  (escombros ambientales)
#            ‚ñ≤  (sitio arqueol√≥gico)
#
#  0 UA Agujero Negro Central
#            ‚¨§
#
# Cintur√≥n de Asteroides (25-60 UA)
#    *  *  *  *  *  *  *  *
#
# Megaconstrucci√≥n: Gateway arruinado
#    ‚ñ≤  (posici√≥n orbital aleatoria)
#
# Notas:
# - Cada planeta puede contener lunas adicionales, objetos ambientales y sitios arqueol√≥gicos.
# - Campos de debris orbitando agregan zonas de riesgo moderadas inspiradas en Scavenger Bot System.
# - Planeta de robots primitivos sirve como punto narrativo y exploratorio.
# - Nubes de polvo y efectos de luz aplicados globalmente para dar ambiente visual.
# - El sistema es narrativamente aislado, rico en reliquias y con peligros ambientales.

mpp_system_dark_relic_initializer = {
    name = "mpp_system_dark_relic"
    max_instances = 1

    usage = misc_system_init
    flags = { 
        mpp_flag_dark_relic_system          # Identificador principal del sistema Dark Relic
        mpp_flag_primitive_culture          # Contiene planeta con cultura primitiva de robots
        mpp_flag_relics                     # Contiene clusters de reliquias antiguas
        mpp_flag_debris_fields              # Zonas de riesgo con escombros dispersos
        mpp_flag_drone_activity             # Flota de drones moderada presente
        mpp_flag_environmental_hazards      # Niebla, polvo y efectos visuales globales
    }
    usage_odds = {
        base = 0  # probabilidad inicial muy baja

        # Probabilidad alta si est√° cerca del sistema de investigaci√≥n
        modifier = {
            add = 35
            near_system_with_flag = mpp_flag_research_hub
        }

        # Probabilidad alta si est√° cerca de primitive robot culture
        modifier = {
            add = 30
            near_system_with_flag = mpp_flag_primitive_robot_culture
        }

        # Probabilidad extra si hay otras megastructuras ‚Äúcustom‚Äù alrededor
        modifier = {
            add = 25
            near_system_with_flag = mpp_flag_custom_megastructure
        }

        # Evitar FE o clusters imperiales
        modifier = {
            factor = 0
            is_fe_cluster = yes
        }
        modifier = {
            factor = 0
            has_star_flag = empire_cluster
        }

        # Evitar cuellos de botella
        modifier = {
            factor = 0
            is_bottleneck_system = yes
        }
    }

    class = "sc_black_hole"  # Agujero negro central del sistema

    # ===============================================
    # Estrella central
    # Fuente gravitatoria y punto de referencia para √≥rbitas de debris y planetas
    # ===============================================
    planet = {
        class = star
        orbit_distance = 0
        size = 20
        has_ring = no
        init_effect = {
            save_event_target_as = mpp_star_dark_relic
            save_event_target_as = mpp_system_dark_relic_ref
            # Nube de part√≠culas azul alrededor del agujero negro
            create_ambient_object = {
                type = "particle_cloud"
                entity_offset = { x = 0 y = 0 z = 0 }
                entity_scale = { min = 5 max = 15 }
                particle_color = { r = 50 g = 100 b = 200 a = 100 }
                rotation_speed = { x = 0 y = 0 z = 5 }
            }
        }
    }

    # ===============================================
    # Asteroid belt cercano al agujero negro
    # Inspiraci√≥n: Scavenger Bot System, a√±ade zona de riesgo con debris y artefactos
    # ===============================================
    asteroid_belt = {
        type = rocky_asteroid_belt
        radius = 40
        count = 20
        init_effect = {
            every_asteroid = {
                create_ambient_object = { type = "medium_debris_01_object" location = this }
                create_ambient_object = { type = "small_debris_object" location = this }
                create_ambient_object = { type = "ancient_artifact_object" location = this }
                last_created_ambient_object = {
                    add_modifier = { modifier = glowing_object; days = -1 }
                    add_modifier = { modifier = flicker_light; days = -1 }
                    set_rotation = { x = random y = random z = random }
                }
            }
        }
    }

    # ===============================================
    # Cluster de reliquias orbitando la estrella
    # A√±ade inter√©s visual y exploratorio, sensaci√≥n de peligro antiguo
    # ===============================================
    init_effect = {
        repeat = 15
        create_ambient_object = { type = "ancient_artifact_object" location = prev }
        last_created_ambient_object = {
            set_orbit = {
                target = event_target:mpp_star_dark_relic
                distance = { min = 25 max = 60 }
                angle = random
                orbit_speed = { min = 1 max = 5 }
                rotate_axis = { x = random y = random z = random }
            }
            add_modifier = { modifier = glowing_object; days = -1 }
            add_modifier = { modifier = slow_rotation; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    # ===============================================
    # Planeta shrouded con debris y ruinas antiguas
    # Inspiraci√≥n: Scavenger Bot System, punto de inter√©s exploratorio
    # ===============================================
    planet = {
        class = "pc_shrouded"
        orbit_distance = 20
        orbit_angle = 45
        size = 18
        has_ring = no
        init_effect = {
            create_ambient_object = { type = "large_debris_object" location = this }
            create_ambient_object = { type = "medium_debris_01_object" location = this }
            create_ambient_object = { type = "medium_debris_02_object" location = this }
            create_ambient_object = { type = "small_debris_object" location = this }
            create_ambient_object = { type = "ancient_artifact_object" location = this }
            create_ambient_object = { type = "abandoned_station_object" location = this }
            create_particle_effect = { type = "dust_cloud"; intensity = 0.6 }
            add_modifier = { modifier = flicker_light; days = -1 }
            create_archaeological_site = ancrel_site_1
        }
    }

    # ===============================================
    # Planeta nuked con dep√≥sitos raros y artefactos
    # Inspiraci√≥n: Scavenger Bot System y zonas de peligro
    # ===============================================
    planet = {
        class = "pc_nuked"
        orbit_distance = 25
        orbit_angle = 120
        size = 20
        has_ring = no
        init_effect = {
            create_ambient_object = { type = "abandoned_starbase_01_object" }
            last_created_ambient_object = { set_location = { target = prev distance = 15 angle = random }
                                            save_global_event_target_as = the_dark_relic_obj }
            create_ambient_object = { type = "large_debris_object" }
            last_created_ambient_object = { set_location = event_target:the_dark_relic_obj }
            create_ambient_object = { type = "ancient_artifact_object" }
            create_particle_effect = { type = "radiation_glow"; intensity = 0.8 }
            add_modifier = { modifier = flicker_light; days = -1 }
            clear_deposits = yes
            clear_blockers = yes
            add_deposit = d_metal_boneyard
            add_deposit = d_irradiated_valley
            add_deposit = d_impact_crater
            add_deposit = d_ore_rich_caverns
            add_deposit = d_underwater_vent
            add_deposit = d_radioactive_wasteland
            add_deposit = d_city_ruins
            create_archaeological_site = ancrel_site_2
        }
    }

    # ===============================================
    # Planeta shattered con luna rota
    # Inspiraci√≥n: debris fields del Scavenger Bot System, zona de riesgo elevada
    # ===============================================
    planet = {
        class = "pc_shattered"
        orbit_distance = 35
        orbit_angle = 1
        size = 16
        has_ring = no
        init_effect = {
            prevent_anomaly = yes
            create_ambient_object = { type = "large_debris_object" location = this }
            create_ambient_object = { type = "medium_debris_01_object" location = this }
            create_ambient_object = { type = "ancient_artifact_object" location = this }
            add_modifier = { modifier = slow_rotation; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
        moon = {
            class = "pc_broken"
            size = 6
            orbit_distance = 12
            orbit_angle = 50
            has_ring = no
            init_effect = {
                create_ambient_object = { type = "small_debris_object" location = this }
                create_ambient_object = { type = "ancient_artifact_object" location = this }
                add_modifier = { modifier = slow_rotation; days = -1 }
                add_modifier = { modifier = flicker_light; days = -1 }
            }
        }
    }

    # ===============================================
    # Gigante gaseoso oscuro con luna t√≥xica
    # Inspiraci√≥n: zonas hostiles y debris fields de Scavenger Bot System
    # ===============================================
    planet = {
        class = "pc_gas_giant"
        orbit_distance = 45
        orbit_angle = 165
        size = 30
        has_ring = yes
        init_effect = { prevent_anomaly = yes }
        moon = {
            class = "pc_toxic"
            size = 7
            orbit_distance = 15
            orbit_angle = 100
            init_effect = {
                prevent_anomaly = yes
                create_ambient_object = { type = "ancient_artifact_object" }
                create_ambient_object = { type = "medium_debris_02_object" location = this }
                create_ambient_object = { type = "small_debris_object" location = this }
                add_modifier = { modifier = glowing_object; days = -1 }
                add_modifier = { modifier = flicker_light; days = -1 }
            }
        }
    }

    # ===============================================
    # Planeta barren fr√≠o
    # Inspiraci√≥n: debris menores del Scavenger Bot System
    # Zona de riesgo leve, sensaci√≥n de sistema antiguo
    # ===============================================
    planet = {
        class = "pc_barren_cold"
        orbit_distance = 50
        orbit_angle = 210
        size = 15
        has_ring = no
        init_effect = {
            create_ambient_object = { type = "medium_debris_02_object" location = this }
            create_ambient_object = { type = "small_debris_object" location = this }
            add_modifier = { modifier = dust_cloud; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    # ===============================================
    # Asteroides dispersos adicionales
    # Inspiraci√≥n: Scavenger Bot System, obst√°culos en periferia
    # ===============================================
    planet = {
        count = { min = 8 max = 12 }
        class = pc_asteroid
        size = { min = 2 max = 4 }
        orbit_distance = { min = 25 max = 60 }
        orbit_angle = { min = 0 max = 360 }
        init_effect = {
            create_ambient_object = { type = "medium_debris_01_object" location = this }
            add_modifier = { modifier = slow_rotation; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    # ===============================================
    # Planeta de robots primitivos
    # Inspiraci√≥n: Distar Robo Cat, punto narrativo y de exploraci√≥n
    # ===============================================
    planet = {
        count = 1
        orbit_distance = 28
        orbit_angle = 150
        size = { min = 12 max = 25 }
        class = "rl_cool_moist_planets"
        anomaly = "DISTAR_ROBO_CAT"
        init_effect = {
            set_planet_flag = primitive_robot_planet
            prevent_anomaly = yes
            add_deposit = d_city_ruins
            add_deposit = d_city_ruins
            add_deposit = d_failing_infrastructure
            add_deposit = d_failing_infrastructure
            add_deposit = d_metal_boneyard
            create_ambient_object = { type = "medium_debris_01_object" location = this }
            create_ambient_object = { type = "small_debris_object" location = this }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    # ===============================================
    # Zonas de riesgo inspiradas en Scavenger Bot System
    # Debris y artefactos orbitando, creando obst√°culos y √°reas peligrosas
    # ===============================================
    init_effect = {
        repeat = 5
        create_ambient_object = { type = "large_debris_object" location = prev }
        last_created_ambient_object = {
            set_orbit = {
                target = event_target:mpp_star_dark_relic
                distance = { min = 20 max = 55 }
                angle = random
                orbit_speed = { min = 1 max = 4 }
                rotate_axis = { x = random y = random z = random }
            }
            add_modifier = { modifier = slow_rotation; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }

        repeat = 8
        create_ambient_object = { type = "medium_debris_01_object" location = prev }
        last_created_ambient_object = {
            set_orbit = {
                target = event_target:mpp_star_dark_relic
                distance = { min = 25 max = 60 }
                angle = random
                orbit_speed = { min = 1 max = 3 }
            }
            add_modifier = { modifier = flicker_light; days = -1 }
        }

        repeat = 12
        create_ambient_object = { type = "small_debris_object" location = prev }
        last_created_ambient_object = {
            set_orbit = {
                target = event_target:mpp_star_dark_relic
                distance = { min = 25 max = 65 }
                angle = random
                orbit_speed = { min = 0.5 max = 2 }
            }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    # ===============================================
    # Flota de drones moderada
    # Inspiraci√≥n: Scavenger Bot System, sin ser demasiado poderosa
    # ===============================================
    init_effect = {
        create_drone_country = yes
        random_system_planet = {
            limit = {
                has_deposit_for = shipclass_mining_station
                is_star = no
                NOT = { is_planet_class = pc_gas_giant }
            }
            set_deposit = d_minerals_4
            event_target:drone_country = {
                save_event_target_as = mining_drones
                create_fleet = {
                    name = "NAME_Ancient_Mining_Drones"
                    effect = {
                        set_owner = event_target:drone_country
                        while = { count = 6 create_ship = { design = "NAME_Ancient_Mining_Drone" } }
                        while = { count = 3 create_ship = { design = "NAME_Ancient_Combat_Drone" } }
                        set_location = PREVPREV
                        set_fleet_stance = aggressive
                        set_aggro_range = 80
                        queue_actions = { repeat = { wait = { duration = 999 random = 10 } } }
                    }
                }
            }
            create_mining_station = { owner = event_target:mining_drones }
        }
    }

    # ===============================================
    # Efecto global del sistema
    # A√±ade coherencia visual y vestigios de debris menores en todos los planetas
    # Megastructura arruinada para exploraci√≥n arqueol√≥gica
    # ===============================================
    init_effect = {
        every_planet = {
            create_ambient_object = { type = "small_debris_object" location = this }
            create_ambient_object = { type = "medium_debris_02_object" location = this }
            add_modifier = { modifier = flicker_light; days = -1 }
        }

        spawn_megastructure = {
            type = "gateway_ruined"
            random_pos = yes
            orbit_angle = 360
            add_modifier = { modifier = glowing_object; days = -1 }
            add_modifier = { modifier = flicker_light; days = -1 }
        }
    }

    init_effect = {
        
    }
}